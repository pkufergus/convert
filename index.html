<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Convert TTF to WOFF online</title>
  <style>
    html {margin: 0; padding: 0; width: 100%; height: 100%;}
    body {height: 100%; padding: 1em; box-sizing: border-box; max-width: 40em; margin: auto;}
    h1, h2 {font-family: sans-serif;}
    a {display: block; margin-top: 1em;}    
    #github {position: absolute; right: .5em; top: -.5em;}
  </style>
  <script src="font_lib/api.js"></script>
  <script src="font_lib/b64.js"></script>
  <script src="font_lib/vdtDict.js"></script>
  <script src="font_lib/pako_deflate.js"></script>
  <script src="font_lib/pako_inflate.js"></script>
  <script src="font_lib/ttf2woff.js"></script>
  <script src="font_lib/TableTTFs.js"></script>
  <script src="font_lib/util.js"></script>
  <script src="font_lib/GenerateTTF.js"></script>
  <script src="font_lib/TableCmap.js"></script>
  <script src="font_lib/TableLoca.js"></script>
  <script src="font_lib/TableHhea.js"></script>
  <script src="font_lib/TableHead.js"></script>
  <script src="font_lib/TableGlyf.js"></script>
  <script src="font_lib/TableMaxp.js"></script>
  <script src="font_lib/TableOs2.js"></script>
  <script src="font_lib/TableHmtx.js"></script>
  <script src="font_lib/TablePost.js"></script>
  <script src="font_lib/test.js"></script>
</head>
<body>

<script>

  function buffer2url(buffer) {
    return URL.createObjectURL(new Blob([buffer], {type: 'application/font-sfnt'}));
  }
  function buffer2url_woff(buffer) {
    return URL.createObjectURL(new Blob([buffer], {type: 'application/font-woff'}));
  }

  document.documentElement.ondragover = function(event) {
    if (event.dataTransfer.items) {
      return [].filter.call(event.dataTransfer.items, function(item) {
        return item.kind !== 'file' || !item.type !== 'application/font-woff';
      }).length === 0;
    } else {
      return !event.dataTransfer.types.contains('application/x-moz-file')
    }
  };
  
  document.documentElement.ondrop = function(event) {
    event.preventDefault();

    var container = document.getElementById('fonts');

    [].forEach.call(event.dataTransfer.files, function(file) {
      var reader = new FileReader();
      reader.onload = function(event) {
        var link = container.insertBefore(document.createElement('a'), container.firstElementChild);
        link.textContent = link.download = file.name.replace(/\.woff$/, '.otf');
        link.href = buffer2url(convert_streams(event.target.result));
      };
      reader.readAsArrayBuffer(file);
    });

    return false;
  };
  
function uploadAndSubmit() { 
  var form = document.forms["demoForm"]; 

  if (form["file"].files.length > 0) { 
    // 寻找表单域中的 <input type="file" ... /> 标签
    var file = form["file"].files[0]; 
    console.log("file name = %s", file.name)
    // try sending 
    var reader = new FileReader(); 

    reader.onloadstart = function() { 
      // 这个事件在读取开始时触发
      console.log("onloadstart"); 
      document.getElementById("bytesTotal").textContent = file.size; 
    } 
    reader.onprogress = function(p) { 
      // 这个事件在读取进行中定时触发
      console.log("onprogress"); 
      document.getElementById("bytesRead").textContent = p.loaded; 
    } 

    var container = document.getElementById('fonts');
    reader.onload = function(event) { 
      // 这个事件在读取成功结束后触发
      console.log("load complete"); 
      var link = container.insertBefore(document.createElement('a'), container.firstElementChild);
      link.textContent = link.download = file.name.replace(/\.ttf$/, '.woff');
      console.log("file name = %s --> %s", file.name, link.textContent)
      var errorCode = new Object();
      errorCode.status = -1;
      console.log("err code = %d", errorCode.status);
      link.href = buffer2url_woff(ttf2woff(event.target.result, errorCode));
      console.log("err code = %d", errorCode.status);
      console.log("load complete 2"); 
    } 

    reader.readAsArrayBuffer(file); 
  } else { 
    alert ("Please choose a file."); 
  } 
}

window.currentArray = new Object();
function logArray() {
  window.currentArray=TableTTFs.HeadTable;
    document.getElementById("process").innerHTML+= "currentArray length =" + window.currentArray.length + "<br>";
    for (var i = 0; i < 10 && i < window.currentArray.length; i++) {
      document.getElementById("process").innerHTML+= "currentArray "+i+ "=" + window.currentArray[i]+"&nbsp&nbsp&nbsp&nbsp";
    }
    document.getElementById("process").innerHTML+= "<br>";
}
function run_main() {
  var url = "127.0.0.1"
  var fontId = 1;
  var ulist = new Array();
  ulist.push(54);
  if (!ttfInfoMap.hasKey(fontId)) {
    getInitJsonData(url, fontId);
  } else {
    getJsonDataFromUrl(url, fontId, ulist);
  }
}
</script>

<h1>Convert TTF to WOFF online</h1>
<h2>download files from here</h2>
<section id="fonts"></section>
<section id="output"></section>

<!-- 用于文件上传的表单元素 --> 
<section>
<!-- <form name="demoForm" id="demoForm" method="post" enctype="multipart/form-data"  action="javascript: uploadAndSubmit();"> --> 
  <!-- <p>Upload File: <input type="file" name="file" /></p> --> 
  <!-- <p><input type="submit" value="Submit" /></p> --> 
<!-- </form> --> 
<!-- <div>Progessing (in Bytes): <span id="bytesRead"> --> 
  <!-- </span> / <span id="bytesTotal"></span> --> 
<!-- </div> --> 
</section>
<button onclick="run_main()">click here to generate TTF</button>
<p id="process"> process...</br></p>
<script>
var TableTTFs = new TableTTFsClass();
document.getElementById("process").innerHTML+= "TableTTFs id = " + TableTTFs.Id + "<br>";
readUrlBinary("data/HeadInfo/OS2Table", TableTTFs);
readUrlBinary("data/HeadInfo/HeadTable", TableTTFs);
readUrlBinary("data/HeadInfo/HheaTable", TableTTFs);
readUrlBinary("data/HeadInfo/MaxpTable", TableTTFs);
readUrlBinary("data/HeadInfo/NameTable", TableTTFs);
readUrlBinary("data/HeadInfo/PostTable", TableTTFs);
readUrlBinary("data/HeadInfo/Cvt_Table", TableTTFs);
readUrlBinary("data/HeadInfo/FpgmTable", TableTTFs);
readUrlBinary("data/HeadInfo/PrepTable", TableTTFs);
readUrlBinary("data/HeadInfo/GaspTable", TableTTFs);
readUrlText("data/HeadInfo/FontName.txt", TableTTFs);
readUrlText("data/HeadInfo/FontFace.txt", TableTTFs);


var fonts = new Array("中","之", "凤", "国","字","形","文","梅","毛","破","美","舞","行","裂","金","飞","龙");
<!-- var fonts = new Array("一","与","二","别"," 区"," 卢","同"); -->
TableGlyfsList = new Array(fonts.length)

var i = 0
for (i = 0; i< fonts.length; i++) {
  font=fonts[i];
  TableGlyfsList[i] = new TableGlyfs();
  readUrlText("data/FontInfo/"+ font + "/Unicode.txt", TableGlyfsList[i]);
  readUrlBinary("data/FontInfo/" + font + "/GlyfTable", TableGlyfsList[i]);
  readUrlText("data/FontInfo/" + font + "/LSB.txt", TableGlyfsList[i]);
  readUrlText("data/FontInfo/" + font + "/HorizAdvX.txt", TableGlyfsList[i]);
}

test_test();
getInitFontInfo();
</script>
</body>
</html>
